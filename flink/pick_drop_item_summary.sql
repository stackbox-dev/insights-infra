-- Create final summary table structure
CREATE TABLE `sbx-uat.wms.public.pick_drop_item_summary`
(
    pick_item_id STRING,
    wh_id BIGINT,
    picked_bin STRING,
    picked_sku STRING,
    picked_batch STRING,
    picked_uom STRING,
    picked_qty STRING,
    overall_qty INT,
    qty INT,
    hu_code STRING,
    destination_bin_code STRING,
    pick_item_created_at TIMESTAMP(3),
    picked_qty_int INT,
    picked_at TIMESTAMP(3),
    worker_code STRING,
    moved_at TIMESTAMP(3),
    processed_at TIMESTAMP(3),
    picked_hu_eq_uom STRING,
    picked_has_inner_hus BOOLEAN,
    picked_inner_hu_eq_uom STRING,
    picked_bin_assigned_at TIMESTAMP(3),
    scan_source_hu_kind STRING,
    pick_source_hu_kind STRING,
    carrier_hu_kind STRING,
    scanned_source_hu_code STRING,
    picked_source_hu_code STRING,
    carrier_hu_code STRING,
    hu_kind STRING,
    source_hu_eq_uom STRING,
    pick_item_updated_at TIMESTAMP(3),
    eligible_drop_locations STRING,
    parent_item_id STRING,
    old_batch STRING,
    dest_bucket STRING,
    lm_trip_id STRING,
    picked_inner_hu_code STRING,
    picked_inner_hu_kind_code STRING,
    picked_quant_bucket STRING,
    pick_auto_complete BOOLEAN,
    pick_hu BOOLEAN,
    short_allocation_reason STRING,
    drop_item_previous_task_id STRING,
    drop_item_id STRING,
    dropped_sku STRING,
    dropped_batch STRING,
    dropped_uom STRING,
    drop_bucket STRING,
    dropped_qty INT,
    picked_hu_code STRING,
    dropped_bin_code STRING,
    dropped_qty_int INT,
    dropped_at TIMESTAMP(3),
    drop_item_updated_at TIMESTAMP(3),
    drop_hu_in_bin BOOLEAN,
    scan_dest_hu BOOLEAN,
    allow_hu_break BOOLEAN,
    dropped_has_inner_hus BOOLEAN,
    scan_inner_hus BOOLEAN,
    dropped_hu_eq_uom STRING,
    dest_hu_code STRING,
    hu_code STRING,
    dropped_inner_hu_eq_uom STRING,
    dest_bin_assigned_at TIMESTAMP(3),
    drop_uom STRING,
    drop_parent_item_id STRING,
    hu_broken BOOLEAN,
    original_source_bin_code STRING,
    processed_for_loading_at TIMESTAMP(3),
    drop_quant_bucket STRING,
    dropped_inner_hu_code STRING,
    dropped_inner_hu_kind_code STRING,
    drop_inner_hu BOOLEAN,
    allow_inner_hu_break BOOLEAN,
    inner_hu_broken BOOLEAN,
    drop_auto_complete BOOLEAN,
    quant_slotting_for_hus BOOLEAN,
    processed_on_drop_at TIMESTAMP(3),
    allow_hu_break_v2 BOOLEAN,
    task_kind STRING,
    task_code STRING,
    task_sequence INT,
    task_state STRING,
    task_attrs STRING,
    task_progress STRING,
    task_created_at TIMESTAMP(3),
    task_updated_at TIMESTAMP(3),
    allow_force_complete BOOLEAN,
    wave INT,
    force_completed BOOLEAN,
    task_subkind STRING,
    `label` STRING,
    session_kind STRING,
    session_code STRING,
    session_attrs STRING,
    session_created_at TIMESTAMP(3),
    session_updated_at TIMESTAMP(3),
    active BOOLEAN,
    session_state STRING,
    session_progress STRING,
    session_auto_complete BOOLEAN,
    worker_attrs STRING,
    worker_name STRING,
    supervisor BOOLEAN,
    product_code STRING,
    principal_id BIGINT,
    sku_id STRING,
    sku_code STRING,
    category STRING,
    class_value STRING,
    node_id BIGINT,
    node_override_class STRING,
    final_class STRING,
    encarta_uom_id STRING,
    encarta_uom_code STRING,
    ibc STRING,
    case_count STRING,
    pallet_count STRING,
    lm_trip_code STRING,
    lm_trip_priority INT,
    lm_dockdoor STRING,
    lm_vehicle_no STRING,
    lm_vehicle_type STRING,
    lm_delivery_date DATE,
    xdock STRING,
    mm_trip_code STRING,
    mm_trip_priority INT,
    mm_dockdoor STRING,
    mm_vehicle_no STRING,
    mm_vehicle_type STRING,
    mm_delivery_date DATE,
    PRIMARY KEY (pick_item_id, drop_item_id) NOT ENFORCED
) WITH (
    'connector' = 'confluent',
    'value.format' = 'avro-registry'
);

-- Continuously populate the summary table
